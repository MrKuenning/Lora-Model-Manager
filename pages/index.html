<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lora Model Manager</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/loading.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Loading Progress Bar -->
    <div id="loading-progress-bar" class="loading-progress-bar">
        <div class="loading-progress-fill"></div>
    </div>

    <div class="app-container">
        <header>
            <div class="header-top">
                <div class="header-left">
                    <h1>Lora Model Manager</h1>
                    <div class="view-controls">
                        <button id="grid-view-btn" class="btn btn-medium btn-primary active">Grid View</button>
                        <button id="table-view-btn" class="btn btn-medium btn-secondary">Table View</button>
                    </div>
                </div>
                <div class="header-top-controls">
                    <button id="civitaiScanButton" class="btn btn-medium btn-primary" title="Scan models with Civitai">
                        <i class="fas fa-search"></i> Civitai Scan
                    </button>
                    <button id="refresh-btn" class="btn btn-medium btn-secondary" title="Refresh models">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <div class="safemode-toggle-container">
                        <span class="safemode-label">SafeMode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="safemodeToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <button id="settingsButton" class="settings-gear">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            <div class="search-filter">
                <div class="search-container">
                    <div class="search-container">
                        <input type="text" id="search-input" placeholder="Search models..." />
                        <button id="clear-search-btn" class="clear-search-btn" title="Clear search"
                            style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="search-syntax-guide">
                        <span class="syntax-title">Search Syntax:</span>
                        <span class="syntax-item"><code>space</code> = AND</span>
                        <span class="syntax-item"><code>|</code> = OR</span>
                        <span class="syntax-item"><code>!</code> = NOT</span>
                        <span class="syntax-item"><code>&lt; &gt;</code> = Group</span>
                        <span class="syntax-item"><code>""</code> = Exact phrase</span>
                    </div>
                </div>
                <div class="dropdown-container">
                    <div class="dropdown-item">
                        <select id="group-select">
                            <option value="none">No Grouping</option>
                            <option disabled>──────────</option>
                            <option disabled>Group By:</option>
                            <option value="Category">Category</option>
                            <option value="Civitai Name">Civitai Name</option>
                            <option value="Model Name">Model Name</option>
                            <option value="Model Version">Model Version</option>
                            <option value="Base Model">Base Model</option>
                            <option value="Subcategory">Subcategory</option>
                            <option value="Folder">Folder</option>
                            <option value="Creator">Creator</option>
                            <option value="Tags">Tags</option>
                            <option value="High/Low">High/Low</option>
                            <option value="NSFW">NSFW</option>
                            <option value="Size">Size</option>
                            <option value="Date">Date</option>
                            <option value="Path">Path</option>
                        </select>
                        <span class="dropdown-description"><strong>Group</strong> Models</span>
                    </div>
                    <div class="dropdown-item">
                        <select id="model-filter-select">
                            <option value="all">All Models</option>
                        </select>
                        <span class="dropdown-description"><strong>Filter</strong> by Model</span>
                    </div>
                    <div class="dropdown-item">
                        <select id="sort-select">
                            <option value="name-asc">Name (A-Z)</option>
                            <option value="name-desc">Name (Z-A)</option>
                            <option value="date-newest">Date (Newest)</option>
                            <option value="date-oldest">Date (Oldest)</option>
                            <option disabled>──────────</option>
                            <option disabled>Column Sorting:</option>
                            <option value="column:Filename:asc">Filename (A-Z)</option>
                            <option value="column:Filename:desc">Filename (Z-A)</option>
                            <option value="column:Civitai Name:asc">Civitai Name (A-Z)</option>
                            <option value="column:Civitai Name:desc">Civitai Name (Z-A)</option>
                            <option value="column:Base Model:asc">Base Model (A-Z)</option>
                            <option value="column:Base Model:desc">Base Model (Z-A)</option>
                            <option value="column:Category:asc">Category (A-Z)</option>
                            <option value="column:Category:desc">Category (Z-A)</option>
                            <option value="column:Subcategory:asc">Subcategory (A-Z)</option>
                            <option value="column:Subcategory:desc">Subcategory (Z-A)</option>
                            <option value="column:Folder:asc">Folder (A-Z)</option>
                            <option value="column:Folder:desc">Folder (Z-A)</option>
                            <option value="column:Creator:asc">Creator (A-Z)</option>
                            <option value="column:Creator:desc">Creator (Z-A)</option>
                            <option value="column:Tags:asc">Tags (A-Z)</option>
                            <option value="column:Tags:desc">Tags (Z-A)</option>
                            <option value="column:Path:asc">Path (A-Z)</option>
                            <option value="column:Path:desc">Path (Z-A)</option>
                            <option value="column:Size:asc">Size (Smallest)</option>
                            <option value="column:Size:desc">Size (Largest)</option>
                            <option value="column:Date:asc">Date (Oldest)</option>
                            <option value="column:Date:desc">Date (Newest)</option>
                            <option value="column:NSFW:asc">NSFW (No-Yes)</option>
                            <option value="column:NSFW:desc">NSFW (Yes-No)</option>
                            <option value="column:Positive Words:asc">Positive Words (A-Z)</option>
                            <option value="column:Positive Words:desc">Positive Words (Z-A)</option>
                            <option value="column:Negative Words:asc">Negative Words (A-Z)</option>
                            <option value="column:Negative Words:desc">Negative Words (Z-A)</option>
                            <option value="column:Civitai Words:asc">Civitai Words (A-Z)</option>
                            <option value="column:Civitai Words:desc">Civitai Words (Z-A)</option>
                            <option value="column:Example Prompt:asc">Example Prompt (A-Z)</option>
                            <option value="column:Example Prompt:desc">Example Prompt (Z-A)</option>
                            <option value="column:Description:asc">Description (A-Z)</option>
                            <option value="column:Description:desc">Description (Z-A)</option>
                            <option value="column:Model Name:asc">Model Name (A-Z)</option>
                            <option value="column:Model Name:desc">Model Name (Z-A)</option>
                            <option value="column:Model Version:asc">Model Version (A-Z)</option>
                            <option value="column:Model Version:desc">Model Version (Z-A)</option>
                            <option value="column:High/Low:asc">High/Low (A-Z)</option>
                            <option value="column:High/Low:desc">High/Low (Z-A)</option>
                        </select>
                        <span class="dropdown-description"><strong>Sort</strong> Models</span>
                    </div>
                </div>
        </header>

        <main>
            <div id="models-container" class="grid-view">
                <!-- Models will be displayed here -->
                <div class="placeholder-message">
                    <p>No models loaded. Please set your models directory in Settings.</p>
                </div>
            </div>
        </main>

        <!-- Model Details Modal -->
        <div id="model-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title-container">
                        <h2 id="modal-title" class="modal-title">Model Name</h2>
                        <p id="modal-subtitle" class="modal-subtitle"></p>
                    </div>
                    <div class="modal-header-buttons">
                        <button id="refresh-model-btn" class="modal-btn refresh-btn" title="Refresh model data">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <span class="close-modal">&times;</span>
                    </div>
                </div>
                <div class="model-details">
                    <!-- Top section with 3-column layout -->
                    <div class="model-details-top">
                        <!-- Column 1: Image and non-editable data -->
                        <div class="model-details-left">
                            <div class="model-preview" id="model-preview-container">
                                <img id="modal-preview" src="" alt="Model preview">
                                <div class="image-drop-zone" id="image-drop-zone">
                                    <div class="drop-zone-content">
                                        <i class="fas fa-image"></i>
                                        <p>Drop image here to add thumbnail</p>
                                    </div>
                                </div>
                            </div>

                            <!-- File Info Section -->
                            <div class="model-static-info">
                                <!-- Read-Only File Fields -->
                                <div class="static-info-row">
                                    <label>PATH:</label>
                                    <span id="model-path"></span>
                                </div>
                                <div class="static-info-row">
                                    <label>SIZE:</label>
                                    <span id="model-size"></span>
                                </div>
                                <div class="static-info-row">
                                    <label>DATE:</label>
                                    <span id="model-date"></span>
                                </div>
                            </div>

                            <!-- Model Info Section -->
                            <div class="model-static-info">
                                <h4 class="static-section-title">Model Info</h4>
                                <!-- Editable Model Fields -->
                                <div class="static-info-row editable-static-row">
                                    <label>BASE MODEL:</label>
                                    <div class="static-editable-content">
                                        <span id="model-basemodel-static" class="static-value"></span>
                                        <input type="text" id="model-basemodel-input" class="static-edit-input"
                                            style="display: none;">
                                        <div class="static-edit-buttons">
                                            <button id="edit-basemodel-btn" class="btn btn-tiny btn-secondary"
                                                title="Edit Base Model">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button id="save-basemodel-btn" class="btn btn-tiny btn-success"
                                                title="Save Base Model" style="display: none;">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button id="cancel-basemodel-btn" class="btn btn-tiny btn-secondary"
                                                title="Cancel" style="display: none;">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="static-info-row editable-static-row">
                                    <label>CREATOR:</label>
                                    <div class="static-editable-content">
                                        <span id="model-creator-static" class="static-value"></span>
                                        <input type="text" id="model-creator-input" class="static-edit-input"
                                            style="display: none;">
                                        <div class="static-edit-buttons">
                                            <button id="edit-creator-btn" class="btn btn-tiny btn-secondary"
                                                title="Edit Creator">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button id="save-creator-btn" class="btn btn-tiny btn-success"
                                                title="Save Creator" style="display: none;">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button id="cancel-creator-btn" class="btn btn-tiny btn-secondary"
                                                title="Cancel" style="display: none;">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="static-info-row editable-static-row">
                                    <label>CIVITAI NAME:</label>
                                    <div class="static-editable-content">
                                        <span id="model-author-static" class="static-value"></span>
                                        <input type="text" id="model-author-input" class="static-edit-input"
                                            style="display: none;">
                                        <div class="static-edit-buttons">
                                            <button id="edit-author-btn" class="btn btn-tiny btn-secondary"
                                                title="Edit Civitai Name">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button id="save-author-btn" class="btn btn-tiny btn-success"
                                                title="Save Civitai Name" style="display: none;">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button id="cancel-author-btn" class="btn btn-tiny btn-secondary"
                                                title="Cancel" style="display: none;">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="static-info-row editable-static-row">
                                    <label>URL:</label>
                                    <div class="static-editable-content">
                                        <span id="model-url-static" class="static-value"><a id="model-url-link" href="#"
                                                target="_blank"></a></span>
                                        <input type="text" id="model-url-input" class="static-edit-input"
                                            style="display: none;">
                                        <div class="static-edit-buttons">
                                            <button id="edit-url-btn" class="btn btn-tiny btn-secondary"
                                                title="Edit URL">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button id="save-url-btn" class="btn btn-tiny btn-success" title="Save URL"
                                                style="display: none;">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button id="cancel-url-btn" class="btn btn-tiny btn-secondary"
                                                title="Cancel" style="display: none;">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="static-info-row editable-static-row">
                                    <label>NSFW:</label>
                                    <div class="nsfw-toggle-container">
                                        <button id="nsfw-toggle" class="nsfw-toggle-btn" data-value="false">
                                            <span class="toggle-label">No</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Preferred Weight Slider -->
                            <div class="preferred-weight-container">
                                <div class="slider-header">
                                    <label for="model-preferred-weight">Preferred Weight:</label>
                                    <span id="model-preferred-weight-display" class="field-display"
                                        style="display: inline; padding: 4px 8px; margin-left: 8px;">0.0</span>
                                    <div class="field-edit-buttons">
                                        <button class="btn btn-tiny btn-secondary field-edit-btn"
                                            data-field="model-preferred-weight">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-tiny btn-success field-save-btn"
                                            data-field="model-preferred-weight" style="display: none;">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                            data-field="model-preferred-weight" style="display: none;">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Visual-only gradient bar (shown in view mode) -->
                                <div id="weight-visual-bar" class="weight-visual-bar">
                                    <div class="weight-gradient"></div>
                                    <div id="weight-indicator" class="weight-indicator" style="left: 50%;"></div>
                                </div>

                                <!-- Interactive slider (shown in edit mode) -->
                                <div id="weight-slider-container" style="display: none;">
                                    <input type="range" id="model-preferred-weight" class="field-input weight-slider"
                                        min="-4.0" max="4.0" step="0.1" value="0.0">
                                    <div class="slider-labels">
                                        <span>-4.0</span>
                                        <span>0.0</span>
                                        <span>4.0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Column 2: All editable field sections -->
                        <div class="field-sections-container">
                            <!-- Section: Model Identity -->
                            <h3 class="section-title">Model Identity</h3>
                            <div class="field-section">
                                <!-- Column 1: Model Name and Version -->
                                <div class="model-basic-info">
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Model Name:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-name">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-name" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-name" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display" id="model-name-display"></span>
                                        <input type="text" id="model-name" class="field-input">
                                        <!-- Model Name Helper Buttons -->
                                        <div class="model-name-helper-buttons" style="display: none;">
                                            <button id="model-name-civitai-btn" class="btn btn-small btn-secondary"
                                                title="Populate Model Name with Civitai Name">
                                                <i class="fas fa-cloud-download-alt"></i> Civitai Name
                                            </button>
                                            <button id="model-name-clean-btn" class="btn btn-small btn-secondary"
                                                title="Clean and format Model Name">
                                                <i class="fas fa-broom"></i> Clean
                                            </button>
                                            <button id="model-name-trim-btn" class="btn btn-small btn-secondary"
                                                title="Trim Model Name">
                                                <i class="fas fa-cut"></i> Trim Name
                                            </button>
                                        </div>
                                    </div>

                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Model Version:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-version">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-version" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-version" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display" id="model-version-display"></span>
                                        <input type="text" id="model-version" class="field-input">
                                    </div>

                                    <!-- High/Low Toggle (moved from Categorization) -->
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>High/Low:</label>
                                        </div>
                                        <div class="high-low-toggle-container">
                                            <button id="high-low-toggle" class="high-low-toggle-btn" data-value="">
                                                <span class="toggle-label">None</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Column 2: File Management -->
                                <div class="model-basic-info">
                                    <div class="info-row highlight-box" id="filename-section">
                                        <!-- Default View: Read-only filename display -->
                                        <div id="filename-display-container">
                                            <div class="info-row-header">
                                                <label>Filename:</label>
                                            </div>
                                            <div class="filename-display-value">
                                                <span id="filename-display-text"></span>
                                                <span class="file-extension">.safetensors</span>
                                            </div>
                                        </div>

                                        <!-- Edit Mode: Editable filename (hidden by default) -->
                                        <div id="filename-edit-container" style="display: none;">
                                            <div class="info-row-header">
                                                <label>Filename:</label>
                                            </div>
                                            <div class="filename-parts">
                                                <input type="text" id="model-filename">
                                                <span id="file-extension" class="file-extension">.safetensors</span>
                                            </div>
                                            <!-- Filename Helper Buttons -->
                                            <div class="filename-helper-buttons">
                                                <button id="recommended-filename-btn" class="btn btn-small btn-primary"
                                                    title="Generate recommended filename based on model type">
                                                    <i class="fas fa-magic"></i> Recommended
                                                </button>
                                                <button id="clean-filename-btn" class="btn btn-small btn-secondary"
                                                    title="Clean and format filename">
                                                    <i class="fas fa-broom"></i> Clean
                                                </button>
                                                <button id="use-model-name-btn" class="btn btn-small btn-secondary"
                                                    title="Populate filename with Model Name">
                                                    <i class="fas fa-tag"></i> Model Name
                                                </button>
                                                <button id="creator-suffix-btn" class="btn btn-small btn-secondary"
                                                    title="Append creator name as suffix">
                                                    <i class="fas fa-user-plus"></i> Creator Suffix
                                                </button>
                                                <button id="wan-high-low-btn" class="btn btn-small btn-secondary"
                                                    title="Swap High and Low in filename">
                                                    <i class="fas fa-exchange-alt"></i> High/Low
                                                </button>
                                                <button id="append-prefix-btn" class="btn btn-small btn-secondary"
                                                    title="Add base model prefix to filename">
                                                    <i class="fas fa-plus-circle"></i> Append Prefix
                                                </button>
                                                <button id="append-suffix-btn" class="btn btn-small btn-secondary"
                                                    title="Add base model suffix to filename">
                                                    <i class="fas fa-plus-square"></i> Append Suffix
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- File Location Section -->
                                    <div class="info-row highlight-box" id="location-section">
                                        <!-- Location dropdown (hidden by default) -->
                                        <div id="location-edit-container" style="display: none;">
                                            <div class="info-row-header">
                                                <label>File Location:</label>
                                            </div>
                                            <select id="model-file-location" class="editable-field">
                                                <option value="">Loading...</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Action Buttons - Default View (always visible when not editing) -->
                                    <div id="file-mgmt-actions-default" class="file-mgmt-actions">
                                        <button id="modify-name-btn" class="btn btn-medium btn-secondary">
                                            <i class="fas fa-edit"></i> Modify Name
                                        </button>
                                        <button id="use-recommended-btn" class="btn btn-medium btn-primary">
                                            <i class="fas fa-magic"></i> Use Recommended
                                        </button>
                                        <button id="move-model-btn" class="btn btn-medium btn-secondary">
                                            <i class="fas fa-arrows-alt"></i> Move Model
                                        </button>
                                    </div>

                                    <!-- Action Buttons - Edit Mode (visible when editing filename) -->
                                    <div id="file-mgmt-actions-edit" class="file-mgmt-actions" style="display: none;">
                                        <button id="save-filename-btn" class="btn btn-medium btn-success">
                                            <i class="fas fa-check"></i> Save
                                        </button>
                                        <button id="cancel-filename-btn" class="btn btn-medium btn-secondary">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>

                                    <!-- Action Buttons - Move Mode (visible when moving model) -->
                                    <div id="file-mgmt-actions-move" class="file-mgmt-actions" style="display: none;">
                                        <button id="execute-move-btn" class="btn btn-medium btn-success">
                                            <i class="fas fa-check"></i> Move
                                        </button>
                                        <button id="cancel-move-btn" class="btn btn-medium btn-secondary">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Section 2: Tags, Creator, Category, Subcategory -->
                            <h3 class="section-title">Categorization</h3>
                            <div class="field-section">
                                <!-- Column 2 -->
                                <div class="model-basic-info">
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Tags:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-tags">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-tags" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-tags" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display" id="model-tags-display"></span>
                                        <input type="text" id="model-tags" class="field-input">
                                    </div>
                                </div>

                                <!-- Column 3 -->
                                <div class="model-basic-info">
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Category:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-category">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-category" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-category" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display" id="model-category-display"></span>
                                        <input type="text" id="model-category" class="field-input">
                                    </div>

                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Subcategory:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-subcategory">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-subcategory" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-subcategory" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display" id="model-subcategory-display"></span>
                                        <input type="text" id="model-subcategory" class="field-input">
                                    </div>

                                </div>
                            </div>

                            <!-- Section 3: Textarea fields -->
                            <h3 class="section-title">Keywords</h3>
                            <div class="field-section">
                                <!-- Column 2 -->
                                <div class="model-basic-info">
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Triggerwords for WebUI:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary copy-field-btn"
                                                    data-copy-field="model-positive" title="Copy to clipboard">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-positive">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-positive" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-positive" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display field-display-textarea"
                                            id="model-positive-display"></span>
                                        <textarea id="model-positive" class="field-input"></textarea>
                                    </div>

                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Example Prompt:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary copy-field-btn"
                                                    data-copy-field="model-example-prompt" title="Copy to clipboard">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-example-prompt">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-example-prompt" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-example-prompt" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display field-display-textarea"
                                            id="model-example-prompt-display"></span>
                                        <textarea id="model-example-prompt" class="field-input"></textarea>
                                    </div>

                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Example Prompt 2:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary copy-field-btn"
                                                    data-copy-field="model-example-prompt-2" title="Copy to clipboard">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-example-prompt-2">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-example-prompt-2" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-example-prompt-2" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display field-display-textarea"
                                            id="model-example-prompt-2-display"></span>
                                        <textarea id="model-example-prompt-2" class="field-input"></textarea>
                                    </div>
                                </div>

                                <!-- Column 3 -->
                                <div class="model-basic-info">
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Negative Words for WebUI:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary copy-field-btn"
                                                    data-copy-field="model-negative" title="Copy to clipboard">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-negative">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-negative" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-negative" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display field-display-textarea"
                                            id="model-negative-display"></span>
                                        <textarea id="model-negative" class="field-input"></textarea>
                                    </div>

                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>All Triggerwords:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary copy-field-btn"
                                                    data-copy-field="model-authors" title="Copy to clipboard">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-authors">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-authors" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-authors" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display field-display-textarea"
                                            id="model-authors-display"></span>
                                        <textarea id="model-authors" class="field-input"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Section: Description -->
                            <h3 class="section-title">Description</h3>
                            <div class="field-section">
                                <!-- Column 2 -->
                                <div class="model-basic-info">
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Notes:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-notes">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-notes" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-notes" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display field-display-textarea"
                                            id="model-notes-display"></span>
                                        <textarea id="model-notes" class="field-input"></textarea>
                                    </div>
                                </div>

                                <!-- Column 3 -->
                                <div class="model-basic-info">
                                    <div class="info-row">
                                        <div class="info-row-header">
                                            <label>Description:</label>
                                            <div class="field-edit-buttons">
                                                <button class="btn btn-tiny btn-secondary field-edit-btn"
                                                    data-field="model-description">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-success field-save-btn"
                                                    data-field="model-description" style="display: none;">
                                                    <i class="fas fa-check"></i>
                                                </button>
                                                <button class="btn btn-tiny btn-secondary field-cancel-btn"
                                                    data-field="model-description" style="display: none;">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <span class="field-display field-display-textarea"
                                            id="model-description-display"></span>
                                        <textarea id="model-description" class="field-input"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Civitai Actions Section -->
                        <div class="civitai-actions-section">
                            <h3 class="section-title">Civitai Actions</h3>
                            <div class="civitai-actions-buttons">
                                <button id="get-civitai-data-btn" class="btn btn-medium btn-primary"
                                    title="Fetch Civitai data for this model">
                                    <i class="fas fa-download"></i> Get Civitai Data
                                </button>
                                <button id="create-json-btn" class="btn btn-medium btn-success"
                                    title="Convert .civitai.info to .json for this model">
                                    <i class="fas fa-file-code"></i> Create JSON
                                </button>
                                <button id="download-thumbnail-btn" class="btn btn-medium btn-secondary"
                                    title="Download preview image from Civitai for this model">
                                    <i class="fas fa-image"></i> Download Thumbnail
                                </button>
                                <button id="fix-thumbnail-btn" class="btn btn-medium btn-warning"
                                    title="Fix thumbnail filename for this model">
                                    <i class="fas fa-wrench"></i> Fix Thumbnail Names
                                </button>
                            </div>
                            <div id="civitai-action-status" class="civitai-action-status"></div>

                            <!-- Associated Files List -->
                            <div class="associated-files-box">
                                <h4>Associated Files</h4>
                                <ul id="model-associated-files" class="file-list"></ul>
                            </div>


                            <!-- JSON Editor section -->
                            <div class="json-editor-section">
                                <div class="json-editor-header">
                                    <h3>
                                        JSON Metadata Editor
                                        <button id="toggle-json-editor" class="btn btn-small btn-secondary"
                                            title="Toggle JSON Editor">
                                            <i class="fas fa-chevron-down"></i>
                                        </button>
                                    </h3>
                                </div>
                                <div id="json-editor-content" class="json-editor-content">
                                    <div class="json-type-selector">
                                        <button id="model-json-btn"
                                            class="btn btn-small btn-secondary json-type-btn active">Model
                                            JSON</button>
                                        <button id="civitai-json-btn"
                                            class="btn btn-small btn-secondary json-type-btn">Civitai
                                            Info</button>
                                        <button id="save-json-btn" class="btn btn-small btn-success">Save
                                            JSON</button>
                                        <button id="refresh-json-btn" class="btn btn-small btn-primary">Refresh</button>
                                    </div>
                                    <div class="json-editor-container">
                                        <textarea id="json-editor"></textarea>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content settings-modal-content">
                <span class="close-modal">&times;</span>
                <h3>Settings</h3>
                <div class="setting-group">
                    <label for="modelsDirectoryInput">Lora Models Directory:</label>
                    <div class="directory-input-container">
                        <input type="text" id="modelsDirectoryInput" />
                        <button id="browse-directory" class="btn btn-small btn-primary">Browse</button>
                    </div>
                </div>
                <div class="setting-group">
                    <label>Theme:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="theme" id="theme-dark" value="dark"> Dark</label>
                        <label><input type="radio" name="theme" id="theme-light" value="light"> Light</label>
                    </div>
                </div>
                <div class="setting-group">
                    <label>Default View:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="defaultView" id="default-view-grid" value="grid">
                            Grid</label>
                        <label><input type="radio" name="defaultView" id="default-view-table" value="table">
                            Table</label>
                    </div>
                </div>
                <div class="setting-group">
                    <label>Default Sort:</label>
                    <select id="default-sort-select">
                        <option value="name-asc">Name (A-Z)</option>
                        <option value="name-desc">Name (Z-A)</option>
                        <option value="date-newest">Date (Newest)</option>
                        <option value="date-oldest">Date (Oldest)</option>
                        <option disabled>──────────</option>
                        <option disabled>Column Sorting:</option>
                        <option value="column:Filename:asc">Filename (A-Z)</option>
                        <option value="column:Filename:desc">Filename (Z-A)</option>
                        <option value="column:Civitai Name:asc">Civitai Name (A-Z)</option>
                        <option value="column:Civitai Name:desc">Civitai Name (Z-A)</option>
                        <option value="column:Base Model:asc">Base Model (A-Z)</option>
                        <option value="column:Base Model:desc">Base Model (Z-A)</option>
                        <option value="column:Category:asc">Category (A-Z)</option>
                        <option value="column:Category:desc">Category (Z-A)</option>
                        <option value="column:Subcategory:asc">Subcategory (A-Z)</option>
                        <option value="column:Subcategory:desc">Subcategory (Z-A)</option>
                        <option value="column:Folder:asc">Folder (A-Z)</option>
                        <option value="column:Folder:desc">Folder (Z-A)</option>
                        <option value="column:Creator:asc">Creator (A-Z)</option>
                        <option value="column:Creator:desc">Creator (Z-A)</option>
                        <option value="column:Tags:asc">Tags (A-Z)</option>
                        <option value="column:Tags:desc">Tags (Z-A)</option>
                        <option value="column:Path:asc">Path (A-Z)</option>
                        <option value="column:Path:desc">Path (Z-A)</option>
                        <option value="column:Size:asc">Size (Smallest)</option>
                        <option value="column:Size:desc">Size (Largest)</option>
                        <option value="column:Date:asc">Date (Oldest)</option>
                        <option value="column:Date:desc">Date (Newest)</option>
                        <option value="column:NSFW:asc">NSFW (No-Yes)</option>
                        <option value="column:NSFW:desc">NSFW (Yes-No)</option>
                        <option value="column:Positive Words:asc">Positive Words (A-Z)</option>
                        <option value="column:Positive Words:desc">Positive Words (Z-A)</option>
                        <option value="column:Negative Words:asc">Negative Words (A-Z)</option>
                        <option value="column:Negative Words:desc">Negative Words (Z-A)</option>
                        <option value="column:Civitai Words:asc">Civitai Words (A-Z)</option>
                        <option value="column:Civitai Words:desc">Civitai Words (Z-A)</option>
                        <option value="column:Example Prompt:asc">Example Prompt (A-Z)</option>
                        <option value="column:Example Prompt:desc">Example Prompt (Z-A)</option>
                        <option value="column:Description:asc">Description (A-Z)</option>
                        <option value="column:Description:desc">Description (Z-A)</option>
                        <option value="column:Model Name:asc">Model Name (A-Z)</option>
                        <option value="column:Model Name:desc">Model Name (Z-A)</option>
                        <option value="column:Model Version:asc">Model Version (A-Z)</option>
                        <option value="column:Model Version:desc">Model Version (Z-A)</option>
                        <option value="column:High/Low:asc">High/Low (A-Z)</option>
                        <option value="column:High/Low:desc">High/Low (Z-A)</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label>View Options:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="hideNSFW"> Hide NSFW Content</label>
                    </div>
                </div>
                <div class="setting-group">
                    <label>Table Columns:</label>
                    <div class="columns-container">
                        <div class="columns-header">
                            <span>Visibility</span>
                            <span>Column Name</span>
                            <span>Order</span>
                        </div>
                        <ul id="sortable-columns" class="sortable-columns">
                            <li data-column-key="thumbnail">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-thumbnail"></div>
                                    <div class="column-name">Thumbnail</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="filename">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-filename"></div>
                                    <div class="column-name">Filename</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="authorName">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-author"></div>
                                    <div class="column-name">Civitai Name</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="baseModel">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-basemodel"></div>
                                    <div class="column-name">Base Model</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="category">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-category"></div>
                                    <div class="column-name">Category</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="folder">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-folder"></div>
                                    <div class="column-name">Folder</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="subcategory">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-subcategory"></div>
                                    <div class="column-name">Subcategory</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="creator">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-creator"></div>
                                    <div class="column-name">Creator</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="examplePrompt">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-examplePrompt">
                                    </div>
                                    <div class="column-name">Example Prompt</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="tags">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-tags"></div>
                                    <div class="column-name">Tags</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="path">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-path"></div>
                                    <div class="column-name">Path</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="size">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-size"></div>
                                    <div class="column-name">Size</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="date">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-date"></div>
                                    <div class="column-name">Date</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="url">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-url"></div>
                                    <div class="column-name">URL</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="nsfw">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-nsfw"></div>
                                    <div class="column-name">NSFW</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="positiveWords">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-positive"></div>
                                    <div class="column-name">Positive Words</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="negativeWords">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-negative"></div>
                                    <div class="column-name">Negative Words</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="authorsWords">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-authors"></div>
                                    <div class="column-name">Civitai Words</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="description">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-description"></div>
                                    <div class="column-name">Description</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="notes">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-notes"></div>
                                    <div class="column-name">Notes</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="modelName">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-modelName"></div>
                                    <div class="column-name">Model Name</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="modelVersion">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-modelVersion"></div>
                                    <div class="column-name">Model Version</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                            <li data-column-key="highLow">
                                <div class="column-item">
                                    <div class="column-checkbox"><input type="checkbox" id="col-highLow"></div>
                                    <div class="column-name">High/Low</div>
                                    <div class="column-handle"><i class="fas fa-grip-lines"></i></div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="save-settings" class="btn btn-small btn-success">Save</button>
                    <button id="cancel-settings" class="btn btn-small btn-secondary">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="../scripts/app.js"></script>
</body>

</html>